// assets/js/main.js
(function () {
  // Mobile nav toggle
  const hamburger = document.querySelector('.hamburger');
  const nav = document.querySelector('.nav');
  if (hamburger && nav) {
    hamburger.addEventListener('click', () => {
      const isOpen = nav.style.display === 'flex';
      nav.style.display = isOpen ? 'none' : 'flex';
    });
  }

  // Cookie banner consent
  const banner = document.querySelector('.cookie-banner');
  const acceptBtn = document.getElementById('cookie-accept');
  const declineBtn = document.getElementById('cookie-decline');
  const consent = localStorage.getItem('cookie-consent');

  if (!consent && banner) {
    banner.style.display = 'block';
  }
  const setConsent = (value) => {
    localStorage.setItem('cookie-consent', value);
    banner.style.display = 'none';
  };
  if (acceptBtn) acceptBtn.addEventListener('click', () => setConsent('accepted'));
  if (declineBtn) declineBtn.addEventListener('click', () => setConsent('declined'));

  // Basic cart stub
  const addButtons = document.querySelectorAll('.price .btn');
  const cartItems = JSON.parse(localStorage.getItem('cart-items') || '[]');

  addButtons.forEach((btn) => {
    btn.addEventListener('click', () => {
      const card = btn.closest('.card.price');
      const name = card.querySelector('h3').textContent.trim();
      const price = card.querySelector('.price-row').textContent.trim();
      cartItems.push({ name, price });
      localStorage.setItem('cart-items', JSON.stringify(cartItems));
      alert(`${name} added to cart`);
    });
  });

  // Populate cart page
  const cartList = document.querySelector('.cart-items');
  const subtotalEl = document.querySelector('.cart-summary .summary-row strong');
  const checkoutBtn = document.querySelector('.cart-summary .btn');

  if (cartList && subtotalEl && checkoutBtn) {
    cartList.innerHTML = '';
    if (cartItems.length === 0) {
      cartList.innerHTML = '<p>Your cart is empty.</p>';
      checkoutBtn.disabled = true;
      subtotalEl.textContent = '£0.00';
    } else {
      let subtotal = 0;
      cartItems.forEach((item, i) => {
        const row = document.createElement('div');
        row.className = 'card';
        row.style.marginBottom = '12px';
        row.innerHTML = `
          <div style="display:flex; align-items:center; justify-content:space-between;">
            <div>
              <strong>${item.name}</strong><br/>
              <span style="color:#b7bdc8">${item.price}</span>
            </div>
            <button class="btn btn-ghost" data-index="${i}">Remove</button>
          </div>`;
        cartList.appendChild(row);

        const numeric = Number(item.price.replace(/[^0-9.]/g, ''));
        subtotal += numeric;
      });
      subtotalEl.textContent = `£${subtotal.toFixed(2)}`;
      checkoutBtn.disabled = false;

      cartList.addEventListener('click', (e) => {
        const target = e.target;
        if (target.matches('button[data-index]')) {
          const idx = Number(target.getAttribute('data-index'));
          cartItems.splice(idx, 1);
          localStorage.setItem('cart-items', JSON.stringify(cartItems));
          location.reload();
        }
      });
    }
  }
})();